#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import telebot
from telebot import types
import os
import time
import datetime
import threading
import re
import random
import subprocess
import shutil
import psutil
import requests
import sys
import platform
import distro

# --- CONFIGURATION ---
BOT_TOKEN = "8102622534:AAFhXgaZOk4UItHa1PQgsGfkHsK8LSj-HV0"
ADMIN_USER_ID = 8486562838
ADMIN_USERNAME = "JubairZ"

CHANNEL_IDS = [-1001554012044, -1002378656827, -1001773601997]
REPO_PATH = "/root/data/access"
USERS_FILE = "users.txt"
ALL_USERS_FILE = "all_users.txt"

BOT_START_TIME = time.time()

# Sticker List
raw_stickers = [
    "CAACAgUAAxkBAAEQFh1pTRsAAf5R_J3O652wxdmwM-ds-6sAAq0dAAKfX2lWTZK9M7qWVsw2BA",
    "CAACAgUAAxkBAAEQFh9pTRsWutyYZ0zFjB_i8PqAzdgnIgACyw0AAuiD0FU06OGfD316mTYE",
    "CAACAgUAAxkBAAEQFiFpTRs1IxCdBo76ZrY3-G9VNXTWHAACiREAAm_jIVQPovOPmmpnWDYE",
    "CAACAgUAAxkBAAEQFiNpTRtZewQ7Aqak5RlpHtK7zNHW8AACRRsAAttxcFVn9BSKbnj5pDYE",
    "CAACAgUAAxkBAAEQGG5pTkkanTVCRspKz7QSiGjKRH_POwACyxQAAnCY4FfXWQ4qPSvqIzYE",
    "CAACAgUAAxkBAAEQGHBpTkk373ONRZlwmyof-xTJ2W6LJQACpxsAAlHdoFQmyB_wzHLCvDYE",
    "CAACAgUAAxkBAAEQGHJpTkk-kPydKn74I0TPasp2Ra2rbwAC7hwAAocSKFXHwjYtURdRcTYE",
    "CAACAgUAAxkBAAEQGHRpTklDXkJyvHiD4lKT-X4Unn6uswACxBUAAjZJiVdwaV0lFUhI0DYE"
]
STICKER_IDS = list(set(raw_stickers))

bot = telebot.TeleBot(BOT_TOKEN, parse_mode="Markdown")
broadcast_data = {}

# --- UTILS ---
def to_small_caps(text):
    chars = "abcdefghijklmnopqrstuvwxyz"
    caps = "á´€Ê™á´„á´…á´‡êœ°É¢ÊœÉªá´Šá´‹ÊŸá´É´á´á´˜QÊ€êœ±á´›á´œá´ á´¡xÊá´¢"
    trans = str.maketrans(chars, caps)
    return text.lower().translate(trans)

def make_bar(percent, length=10):
    filled = int(length * percent // 100)
    return 'â–£' * filled + 'â–¢' * (length - filled)

def get_readable_time(seconds):
    m, s = divmod(seconds, 60)
    h, m = divmod(m, 60)
    d, h = divmod(h, 24)
    if d > 0: return f"{int(d)}á´… {int(h)}Êœ {int(m)}á´"
    return f"{int(h)}Êœ {int(m)}á´ {int(s)}êœ±"

def get_readable_size(size_in_bytes):
    for unit in ['B', 'KB', 'MB', 'GB', 'TB']:
        if size_in_bytes < 1024: return f"{size_in_bytes:.2f} {unit}"
        size_in_bytes /= 1024
    return f"{size_in_bytes:.2f} PB"

# --- SYSTEM MONITOR ---
def get_system_status():
    cpu_p = psutil.cpu_percent(interval=0.5)
    cpu_cores = psutil.cpu_count(logical=True)
    mem = psutil.virtual_memory()
    disk = psutil.disk_usage('/')
    os_name = distro.name(pretty=True)
    
    try:
        net = requests.get("http://ip-api.com/json", timeout=3).json()
        ip = net.get("query", "Hidden")
        loc = net.get("country", "Unknown")
    except: ip, loc = "Error", "Error"

    sys_up = get_readable_time(time.time() - psutil.boot_time())
    bot_up = get_readable_time(time.time() - BOT_START_TIME)

    return f"""
â•­â”€{to_small_caps('performance')}
â”‚ ğ—–ğ—£ğ—¨: {make_bar(cpu_p)} {cpu_p}%
â”‚        ({cpu_cores} á´„á´Ê€á´‡êœ±)
â”‚ ğ—¥ğ—”ğ— : {make_bar(mem.percent)} {mem.percent}%
â”‚        ({get_readable_size(mem.used)} / {get_readable_size(mem.total)})
â”‚ ğ——ğ—¶ğ˜€ğ—¸: {make_bar(disk.percent)} {disk.percent}%
â”‚        ({get_readable_size(disk.used)} / {get_readable_size(disk.total)})
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â•­â”€{to_small_caps('system info')}
â”‚ ğ—¢ğ—¦: {os_name}
â”‚ ğ—¨ğ—½ğ˜ğ—¶ğ—ºğ—²: {sys_up}
â”‚ ğ—•ğ—¼ğ˜: {bot_up}
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â•­â”€{to_small_caps('network')}
â”‚ ğ—œğ—£: `{ip}`
â”‚ ğ—Ÿğ—¼ğ—°: {loc}
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯"""

# --- DATABASE ---
def save_user(chat_id):
    if not os.path.exists(ALL_USERS_FILE): open(ALL_USERS_FILE, "w").close()
    with open(ALL_USERS_FILE, "r") as f: users = f.read().splitlines()
    if str(chat_id) not in users:
        with open(ALL_USERS_FILE, "a") as f: f.write(f"{chat_id}\n")

# --- ANIMATIONS ---
def smart_loader(chat_id, text_title):
    base_msg = bot.send_message(chat_id, "â³")
    steps = ["â–ªï¸â–«ï¸â–«ï¸â–«ï¸â–«ï¸", "â–ªï¸â–ªï¸â–«ï¸â–«ï¸â–«ï¸", "â–ªï¸â–ªï¸â–ªï¸â–«ï¸â–«ï¸", "â–ªï¸â–ªï¸â–ªï¸â–ªï¸â–«ï¸", "â–ªï¸â–ªï¸â–ªï¸â–ªï¸â–ªï¸"]
    for i in range(5):
        msg_text = f"""
â•­â”€{to_small_caps(text_title)}
â”‚ ğ—Ÿğ—¼ğ—®ğ—±ğ—¶ğ—»ğ—´: {steps[i]} {(i+1)*20}%
â”‚ ğ—¦ğ˜ğ—®ğ˜ğ˜‚ğ˜€: {to_small_caps('processing request...')}
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯"""
        try: bot.edit_message_text(msg_text, chat_id, base_msg.message_id)
        except: pass
        time.sleep(0.3)
    try: bot.delete_message(chat_id, base_msg.message_id)
    except: pass

def startup_sequence(chat_id):
    try:
        s_msg = bot.send_sticker(chat_id, random.choice(STICKER_IDS))
        time.sleep(2)
        bot.delete_message(chat_id, s_msg.message_id)
    except: pass
    smart_loader(chat_id, "initializing")

# --- GIT HANDLER ---
def git_push_changes(commit_msg):
    try:
        os.chdir(REPO_PATH)
        subprocess.run(["git", "config", "--global", "--add", "safe.directory", REPO_PATH], check=False)
        subprocess.run(["git", "pull"], capture_output=True)
        subprocess.run(["git", "add", "."], check=True)
        subprocess.run(["git", "commit", "-m", commit_msg], capture_output=True)
        res = subprocess.run(["git", "push"], capture_output=True, text=True)
        return res.returncode == 0
    except: return False

# --- HANDLERS ---
@bot.message_handler(commands=['start'])
def start_handler(message):
    uid = message.from_user.id
    cid = message.chat.id
    try: bot.delete_message(cid, message.message_id)
    except: pass
    save_user(uid)
    check_join_status(cid, uid, message.from_user.first_name)

def check_join_status(cid, uid, name):
    missing = []
    for chid in CHANNEL_IDS:
        try:
            stat = bot.get_chat_member(chid, uid).status
            if stat not in ['member', 'administrator', 'creator']:
                link = bot.export_chat_invite_link(chid)
                title = bot.get_chat(chid).title
                missing.append((title, link))
        except: pass
    
    if missing:
        text = f"""
â•­â”€{to_small_caps('access denied')}
â”‚ Êœá´‡ÊŸÊŸá´ {name},
â”‚ Êá´á´œ á´á´œêœ±á´› á´Šá´ÉªÉ´ á´á´œÊ€ á´„Êœá´€É´É´á´‡ÊŸêœ±
â”‚ á´›á´ á´œêœ±á´‡ á´›ÊœÉªêœ± Ê™á´á´›.
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯"""
        mk = types.InlineKeyboardMarkup(row_width=1)
        for title, link in missing:
            mk.add(types.InlineKeyboardButton(f"â• á´Šá´ÉªÉ´ {title}", url=link))
        mk.add(types.InlineKeyboardButton("âœ… á´ á´‡Ê€Éªêœ°Ê á´Šá´ÉªÉ´á´‡á´…", callback_data="chk_join"))
        bot.send_message(cid, text, reply_markup=mk)
    else:
        startup_sequence(cid)
        show_user_menu(cid, uid)

def show_user_menu(cid, uid):
    text = f"""
â•­â”€{to_small_caps('user profile')}
â”‚ ğŸ†” ğ—œğ——: `{cid}`
â”‚ ğŸ›¡ ğ—¥ğ—¼ğ—¹ğ—²: {to_small_caps('user')}
â”‚ ğŸ¤– ğ—•ğ—¼ğ˜: {to_small_caps('online')}
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â•­â”€{to_small_caps('services')}
â”‚ á´„Êœá´á´êœ±á´‡ á´€ êœ±á´‡Ê€á´ Éªá´„á´‡ Ê™á´‡ÊŸá´á´¡
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯"""
    mk = types.InlineKeyboardMarkup(row_width=2)
    mk.add(types.InlineKeyboardButton("ğŸš€ êœ±á´‡É´êœ±á´‡Éª", callback_data="srv_sensei"),
           types.InlineKeyboardButton("ğŸ›  á´„Ê€á´€á´„á´‹", callback_data="srv_crack"))
    mk.add(types.InlineKeyboardButton("ğŸ‘¨â€ğŸ’» á´…á´‡á´ á´‡ÊŸá´á´˜á´‡Ê€", url=f"https://t.me/{ADMIN_USERNAME}"))
    if uid == ADMIN_USER_ID:
        mk.add(types.InlineKeyboardButton("ğŸ‘‘ á´€á´…á´ÉªÉ´ á´˜á´€É´á´‡ÊŸ", callback_data="open_admin"))
    bot.send_message(cid, text, reply_markup=mk)

def show_admin_panel(cid):
    text = f"""
â•­â”€{to_small_caps('admin control')}
â”‚ ğŸ‘‘ ğ—ªğ—²ğ—¹ğ—°ğ—¼ğ—ºğ—² ğ—–ğ—¼ğ—ºğ—ºğ—®ğ—»ğ—±ğ—²ğ—¿
â”‚ ğŸ® ğ—–ğ—¼ğ—»ğ˜ğ—¿ğ—¼ğ—¹ ğ—¬ğ—¼ğ˜‚ğ—¿ ğ—˜ğ—ºğ—½ğ—¶ğ—¿ğ—²
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯"""
    mk = types.InlineKeyboardMarkup(row_width=2)
    mk.add(types.InlineKeyboardButton("ğŸ“Š êœ±á´›á´€á´›á´œêœ±", callback_data="adm_stats"),
           types.InlineKeyboardButton("ğŸ“¢ Ê™Ê€á´á´€á´…á´„á´€êœ±á´›", callback_data="adm_cast"))
    mk.add(types.InlineKeyboardButton("ğŸ“‚ Ê™á´€Yá´‹á´œá´˜", callback_data="adm_backup"),
           types.InlineKeyboardButton("ğŸ”„ Ê€á´‡êœ±á´›á´€Ê€á´›", callback_data="adm_rest"))
    mk.add(types.InlineKeyboardButton("ğŸ”™ Ê™á´€á´„á´‹", callback_data="back_home"))
    bot.send_message(cid, text, reply_markup=mk)

# --- CALLBACKS & LOGIC ---
@bot.callback_query_handler(func=lambda c: c.data == "open_admin")
def open_admin_panel(c):
    if c.from_user.id == ADMIN_USER_ID:
        try: bot.delete_message(c.message.chat.id, c.message.message_id)
        except: pass
        show_admin_panel(c.message.chat.id)

@bot.callback_query_handler(func=lambda c: c.data == "chk_join")
def verify_join(c):
    try: bot.delete_message(c.message.chat.id, c.message.message_id)
    except: pass
    smart_loader(c.message.chat.id, "verifying")
    check_join_status(c.message.chat.id, c.from_user.id, c.from_user.first_name)

@bot.callback_query_handler(func=lambda c: c.data == "back_home")
def go_home(c):
    try: bot.delete_message(c.message.chat.id, c.message.message_id)
    except: pass
    show_user_menu(c.message.chat.id, c.from_user.id)

@bot.callback_query_handler(func=lambda c: c.data == "cancel_op")
def cancel(c):
    try: bot.delete_message(c.message.chat.id, c.message.message_id)
    except: pass
    bot.send_message(c.message.chat.id, "âŒ **Operation Cancelled**")
    show_user_menu(c.message.chat.id, c.from_user.id)

@bot.callback_query_handler(func=lambda c: c.data == "adm_stats")
def adm_stats(c):
    if c.from_user.id != ADMIN_USER_ID: return
    msg = bot.send_message(c.message.chat.id, "â³ **Fetching Data...**")
    report = get_system_status()
    try: bot.edit_message_text(report, c.message.chat.id, msg.message_id)
    except: pass

@bot.callback_query_handler(func=lambda c: c.data == "adm_backup")
def adm_backup(c):
    if c.from_user.id != ADMIN_USER_ID: return
    smart_loader(c.message.chat.id, "zipping data")
    shutil.make_archive("backup", 'zip', REPO_PATH)
    with open("backup.zip", "rb") as f:
        bot.send_document(c.message.chat.id, f, caption=f"ğŸ“¦ **Backup** `{datetime.datetime.now()}`")
    os.remove("backup.zip")

@bot.callback_query_handler(func=lambda c: c.data == "adm_rest")
def restart_bot(c):
    if c.from_user.id != ADMIN_USER_ID: return
    bot.answer_callback_query(c.id, "â™»ï¸ Restarting...", show_alert=True)
    os.execv(sys.executable, ['python3'] + sys.argv)

@bot.callback_query_handler(func=lambda c: c.data == "adm_cast")
def start_broadcast(c):
    if c.from_user.id != ADMIN_USER_ID: return
    try: bot.delete_message(c.message.chat.id, c.message.message_id)
    except: pass
    mk = types.InlineKeyboardMarkup()
    mk.add(types.InlineKeyboardButton("âŒ Cancel", callback_data="cancel_op"))
    msg = bot.send_message(c.message.chat.id, "ğŸ“¢ **Send Broadcast Content:**", reply_markup=mk)
    bot.register_next_step_handler(msg, get_broadcast_content)

def get_broadcast_content(message):
    if message.content_type == 'text' and message.text == '/cancel':
        show_admin_panel(message.chat.id); return
    broadcast_data['msg'] = message
    mk = types.InlineKeyboardMarkup()
    mk.add(types.InlineKeyboardButton("â© Skip Button", callback_data="skip_btn"),
           types.InlineKeyboardButton("âŒ Cancel", callback_data="cancel_op"))
    msg = bot.send_message(message.chat.id, "ğŸ”— **Add Button?**\nFormat: `Text - URL`", reply_markup=mk)
    bot.register_next_step_handler(msg, get_broadcast_btn)

@bot.callback_query_handler(func=lambda c: c.data == "skip_btn")
def skip_button(c):
    broadcast_data['btn'] = None
    confirm_broadcast(c.message.chat.id)

def get_broadcast_btn(message):
    try:
        txt, url = message.text.split(' - ')
        broadcast_data['btn'] = (txt.strip(), url.strip())
        confirm_broadcast(message.chat.id)
    except:
        bot.send_message(message.chat.id, "âŒ **Invalid Format!**")
        show_admin_panel(message.chat.id)

def confirm_broadcast(chat_id):
    mk = types.InlineKeyboardMarkup()
    mk.add(types.InlineKeyboardButton("âœ… Confirm & Pin", callback_data="do_cast"),
           types.InlineKeyboardButton("âŒ Cancel", callback_data="cancel_op"))
    bot.send_message(chat_id, "ğŸ“¢ **Ready to Send?**", reply_markup=mk)

@bot.callback_query_handler(func=lambda c: c.data == "do_cast")
def run_broadcast(c):
    try: bot.delete_message(c.message.chat.id, c.message.message_id)
    except: pass
    if not os.path.exists(ALL_USERS_FILE): return
    with open(ALL_USERS_FILE, "r") as f: users = f.read().splitlines()
    msg_origin = broadcast_data.get('msg')
    btn_data = broadcast_data.get('btn')
    markup = None
    if btn_data:
        markup = types.InlineKeyboardMarkup()
        markup.add(types.InlineKeyboardButton(btn_data[0], url=btn_data[1]))
    status_msg = bot.send_message(c.message.chat.id, f"ğŸš€ **Sending to {len(users)} users...**")
    done, block = 0, 0
    for uid in users:
        try:
            sent = bot.copy_message(chat_id=uid, from_chat_id=msg_origin.chat.id, message_id=msg_origin.message_id, reply_markup=markup)
            bot.pin_chat_message(uid, sent.message_id)
            done += 1
        except: block += 1
        time.sleep(0.05)
    bot.edit_message_text(f"âœ… **Done!**\nSuccess: {done}\nFailed: {block}", c.message.chat.id, status_msg.message_id)
    show_admin_panel(c.message.chat.id)

@bot.callback_query_handler(func=lambda c: c.data == "srv_sensei")
def sensei_flow(c):
    try: bot.delete_message(c.message.chat.id, c.message.message_id)
    except: pass
    mk = types.InlineKeyboardMarkup()
    mk.add(types.InlineKeyboardButton("âŒ á´„á´€É´á´„á´‡ÊŸ", callback_data="cancel_op"))
    msg = bot.send_message(c.message.chat.id, f"â•­â”€{to_small_caps('sensei tunnel')}\nâ”‚ ğŸ“¡ á´‡É´á´›á´‡Ê€ á´ á´˜êœ± Éªá´˜ á´€á´…á´…Ê€á´‡êœ±êœ±:\nâ•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯", reply_markup=mk)
    bot.register_next_step_handler(msg, process_ip)

def process_ip(m):
    ip = m.text.strip()
    if not re.match(r"^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$", ip):
        bot.send_message(m.chat.id, "âŒ **Invalid IP**")
        show_user_menu(m.chat.id, m.from_user.id); return
    mk = types.InlineKeyboardMarkup()
    mk.add(types.InlineKeyboardButton("âŒ á´„á´€É´á´„á´‡ÊŸ", callback_data="cancel_op"))
    msg = bot.send_message(m.chat.id, f"â•­â”€{to_small_caps('username')}\nâ”‚ ğŸ‘¤ á´‡É´á´›á´‡Ê€ á´œêœ±á´‡Ê€É´á´€á´á´‡:\nâ•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯", reply_markup=mk)
    bot.register_next_step_handler(msg, process_user, ip)

def process_user(m, ip):
    user = m.text.strip().replace(" ", "-")
    smart_loader(m.chat.id, "creating access")
    expiry = (datetime.datetime.now() + datetime.timedelta(days=30)).strftime("%Y-%m-%d")
    timestamp = datetime.datetime.now().strftime("%d-%b %I:%M %p")
    try:
        os.chdir(REPO_PATH)
        with open(ip, "w") as f: f.write(user)
        with open(user, "w") as f: f.write(expiry)
        if git_push_changes(f"Sensei: {user}"):
            text = f"""
â•­â”€{to_small_caps('success')}
â”‚ âœ… ğ—”ğ—°ğ—°ğ—²ğ˜€ğ˜€ ğ—–ğ—¿ğ—²ğ—®ğ˜ğ—²ğ—±!
â”‚ ğŸ“¡ ğ—œğ—£: `{ip}`
â”‚ ğŸ‘¤ ğ—¨ğ˜€ğ—²ğ—¿: `{user}`
â”‚ ğŸ“… ğ—˜ğ˜…ğ—½: `{expiry}`
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯"""
            bot.send_message(m.chat.id, text)
            admin_msg = f"""
â•­â”€{to_small_caps('new vps access')}
â”‚ ğŸ‘¤ ğ—¡ğ—®ğ—ºğ—²: [{m.from_user.first_name}](tg://user?id={m.from_user.id})
â”‚ ğŸ†” ğ—œğ——: `{m.from_user.id}`
â”‚ ğŸ”— ğ—¨ğ˜€ğ—²ğ—¿ğ—»ğ—®ğ—ºğ—²: @{m.from_user.username}
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â•­â”€{to_small_caps('data info')}
â”‚ ğŸ“¡ ğ—œğ—£: `{ip}`
â”‚ ğŸ‘¤ ğ—©ğ—£ğ—¦ ğ—¨ğ˜€ğ—²ğ—¿: `{user}`
â”‚ ğŸ“… ğ—˜ğ˜…ğ—½ğ—¶ğ—¿ğ˜†: `{expiry}`
â”‚ âŒš ğ—§ğ—¶ğ—ºğ—²: `{timestamp}`
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯"""
            try: bot.send_message(ADMIN_USER_ID, admin_msg, disable_web_page_preview=True)
            except: pass
        else: bot.send_message(m.chat.id, "âŒ **Git Error**")
    except: bot.send_message(m.chat.id, "âŒ **Server Error**")
    show_user_menu(m.chat.id, m.from_user.id)

@bot.callback_query_handler(func=lambda c: c.data == "srv_crack")
def crack_flow(c):
    try: bot.delete_message(c.message.chat.id, c.message.message_id)
    except: pass
    mk = types.InlineKeyboardMarkup()
    mk.add(types.InlineKeyboardButton("âŒ á´„á´€É´á´„á´‡ÊŸ", callback_data="cancel_op"))
    msg = bot.send_message(c.message.chat.id, f"â•­â”€{to_small_caps('crack tool')}\nâ”‚ ğŸ”‘ á´‡É´á´›á´‡Ê€ ÊŸÉªá´„á´‡É´êœ±á´‡ á´‹á´‡Ê:\nâ•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯", reply_markup=mk)
    bot.register_next_step_handler(msg, crack_key)

def crack_key(m):
    key = m.text.strip()
    final_key = key if key.startswith("##") else f"##{key}"
    mk = types.InlineKeyboardMarkup()
    mk.add(types.InlineKeyboardButton("âŒ á´„á´€É´á´„á´‡ÊŸ", callback_data="cancel_op"))
    msg = bot.send_message(m.chat.id, f"â•­â”€{to_small_caps('username')}\nâ”‚ ğŸ‘¤ á´‡É´á´›á´‡Ê€ Êá´á´œÊ€ É´á´€á´á´‡:\nâ•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯", reply_markup=mk)
    bot.register_next_step_handler(msg, crack_name, final_key)

def crack_name(m, final_key):
    name = m.text.strip()
    smart_loader(m.chat.id, "authorizing")
    timestamp = datetime.datetime.now().strftime("%d-%b %I:%M %p")
    try:
        os.chdir(REPO_PATH)
        with open(USERS_FILE, "a") as f: f.write(f"\n{final_key} {name}")
        if git_push_changes(f"Crack: {name}"):
            bot.send_message(m.chat.id, f"âœ… **Approved!**\nğŸ”‘ `{final_key}`")
            admin_msg = f"""
â•­â”€{to_small_caps('new crack user')}
â”‚ ğŸ‘¤ ğ—¡ğ—®ğ—ºğ—²: [{m.from_user.first_name}](tg://user?id={m.from_user.id})
â”‚ ğŸ†” ğ—œğ——: `{m.from_user.id}`
â”‚ ğŸ”— ğ—¨ğ˜€ğ—²ğ—¿ğ—»ğ—®ğ—ºğ—²: @{m.from_user.username}
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â•­â”€{to_small_caps('license info')}
â”‚ ğŸ”‘ ğ—ğ—²ğ˜†: `{final_key}`
â”‚ ğŸ“ ğ—¡ğ—®ğ—ºğ—²: `{name}`
â”‚ âŒš ğ—§ğ—¶ğ—ºğ—²: `{timestamp}`
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯"""
            try: bot.send_message(ADMIN_USER_ID, admin_msg, disable_web_page_preview=True)
            except: pass
        else: bot.send_message(m.chat.id, "âŒ **Git Error**")
    except: pass
    show_user_menu(m.chat.id, m.from_user.id)

if __name__ == "__main__":
    print("Bot is Online...")
    while True:
        try: bot.polling(non_stop=True)
        except: time.sleep(5)
